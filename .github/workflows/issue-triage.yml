name: Issue Triage

on:
  issues:
    types: [labeled]

jobs:
  issue-creation:
    runs-on: ${{ matrix.os }}
    env:
      TERM: xterm
    strategy:
      matrix:
        os:
          - ubuntu-20.04
    steps:
      - name: View the github context
        run: echo "$GITHUB_CONTEXT"
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
      - name: Transfer Issue
        uses: actions/github-script@v5
        with:
          github-token: ${{ secrets.TRANSFER_ISSUE_TOKEN }}
          script: |
            let labels = [];
            const l = ${{ github.event.issue.labels }};
            l.forEach((label) => {
                labels.push(label.name)
            });
            github.rest.issues.create({
              owner: 'thinktandem',
              repo: 'issue-transfer',
              title: `${{ github.event.issue.title }}`,
              body: `${{ github.event.issue.body }}`,
              labels: labels,
              assignees: [
                `${{ github.event.issue.user.login }}`
              ]
            })
      - name: Close Current Issue
        uses: actions/github-script@v5
        with:
          github-token: ${{ secrets.TRANSFER_ISSUE_TOKEN }}
          script: |
            github.rest.issues.update({
              issue_number: `${{ github.event.issue.number }}`,
              owner: `${{ github.event.organization.login }}`,
              repo: `${{ github.event.repository.name }}`,
              state: 'closed'
            })